"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[3413],{15680:(e,t,a)=>{a.d(t,{xA:()=>d,yg:()=>g});var r=a(96540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),s=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(a),m=n,g=c["".concat(p,".").concat(m)]||c[m]||u[m]||o;return a?r.createElement(g,i(i({ref:t},d),{},{components:a})):r.createElement(g,i({ref:t},d))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:n,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},37866:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var r=a(58168),n=(a(96540),a(15680));const o={description:"Learn how to enhance the quality and relevance of LLM-generated text",sidebar_position:1.1},i="RAG Prompter",l={unversionedId:"portal-guide/agent-system-operators/rag-prompter",id:"portal-guide/agent-system-operators/rag-prompter",title:"RAG Prompter",description:"Learn how to enhance the quality and relevance of LLM-generated text",source:"@site/docs/portal-guide/agent-system-operators/rag-prompter.md",sourceDirName:"portal-guide/agent-system-operators",slug:"/portal-guide/agent-system-operators/rag-prompter",permalink:"/portal-guide/agent-system-operators/rag-prompter",draft:!1,editUrl:"https://github.com/Clarifai/docs/blob/main/docs/portal-guide/agent-system-operators/rag-prompter.md",tags:[],version:"current",sidebarPosition:1.1,frontMatter:{description:"Learn how to enhance the quality and relevance of LLM-generated text",sidebar_position:1.1},sidebar:"tutorialSidebar",previous:{title:"Prompter",permalink:"/portal-guide/agent-system-operators/prompter"},next:{title:"Filter",permalink:"/portal-guide/agent-system-operators/filter"}},p={},s=[{value:"How RAG Works",id:"how-rag-works",level:2},{value:"How to Create a RAG Prompter",id:"how-to-create-a-rag-prompter",level:2},{value:"Step 1: Create an Application",id:"step-1-create-an-application",level:3},{value:"Step 2: Upload Data",id:"step-2-upload-data",level:3},{value:"Step 3: Create a workflow",id:"step-3-create-a-workflow",level:3},{value:"Step 4: Use the workflow",id:"step-4-use-the-workflow",level:3}],d={toc:s},c="wrapper";function u(e){let{components:t,...o}=e;return(0,n.yg)(c,(0,r.A)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"rag-prompter"},"RAG Prompter"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Learn how to enhance the quality and relevance of LLM-generated text")),(0,n.yg)("hr",null),(0,n.yg)("p",null,"The RAG Prompter is a prompt template operator that leverages the ",(0,n.yg)("a",{parentName:"p",href:"https://www.clarifai.com/blog/what-is-rag-retrieval-augmented-generation"},"Retrieval-Augmented Generation (RAG)")," technique to improve the performance of Large Language Models (LLMs). "),(0,n.yg)("p",null,"LLMs have revolutionized natural language understanding across various applications and industries. These models have introduced a new era of quick problem-solving and AI-powered interactions. "),(0,n.yg)("p",null,"However, LLMs are often plagued by these two main limitations:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Most traditional LLMs have a static knowledge base that is limited to a specific period; for example, ChatGPT's knowledge cut-off is in January 2022. This makes them outdated and unable to respond accurately to recent events. ")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},'Most traditional LLMs are trained on an extensive, generalized collection of data, which may not be applicable to your specific use case. Whenever LLMs confront voids in their training data, they might generate seemingly plausible yet erroneous information, a phenomenon referred to as "hallucination."'))),(0,n.yg)("p",null,"RAG helps solve these issues by incorporating your data into the existing dataset that is accessible to LLMs. With the RAG AI framework, you can retrieve facts from an external knowledge base, thereby anchoring LLMs with the most precise and current information available. "),(0,n.yg)("p",null,"Additionally, RAG reduces the necessity for users to continuously train a model on new data and update its parameters to accommodate evolving circumstances. RAG allows users to do much cheaper in-context learning and reduces the need for expensive LLM fine-tuning."),(0,n.yg)("admonition",{type:"note"},(0,n.yg)("ul",{parentName:"admonition"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"The RAG Prompter model type should not be set as an app\u2019s ",(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/portal-guide/workflows/base-workflows/"},"base workflow"),"; otherwise, it would cause a dependency cycle.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"This model generates search billable events. ")))),(0,n.yg)("h2",{id:"how-rag-works"},"How RAG Works"),(0,n.yg)("p",null,"As its name implies, RAG works through two phases: retrieval and content generation. "),(0,n.yg)("p",null,"When a user uploads external data to be used for RAG purposes into a Clarifai application, the data is first chunked into bite-sized pieces. The chunks are then passed through an embedding model, which transforms the data into indexed vectors and stores them in a vector database. "),(0,n.yg)("admonition",{type:"info"},(0,n.yg)("p",{parentName:"admonition"},(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/api-guide/predict/embeddings"},"Embedding models")," are the type of models usually used to convert data into numerical vectors, while preserving meaningful relationships between them. These vectors are like condensed summaries of the data, capturing its important aspects in a way that machine learning models can understand. By using these vectors, the models can now reason about the data, compare different pieces of information, and perform tasks like similarity search. ")),(0,n.yg)("p",null,"When an LLM is asked a question, the prompt will first pass through an embedding model and also be converted into a vector. Algorithms will search the Clarifai vector store to ",(0,n.yg)("em",{parentName:"p"},"retrieve")," the chunks most relevant to that provided user\u2019s prompt. "),(0,n.yg)("p",null,"The most relevant chunks are then appended to the user\u2019s query and served as context \u2013 extending the prompt to the LLM with a lot of background information. "),(0,n.yg)("p",null,"Next, in the generative phase, the LLM leverages the ",(0,n.yg)("em",{parentName:"p"},"augmented")," prompt along with its internal representation of training data to craft a compelling response tailored to the user's query at that moment."),(0,n.yg)("p",null,(0,n.yg)("img",{parentName:"p",src:"https://www.clarifai.com/hs-fs/hubfs/rag-query-drawio%20(1)-png-2.png?width=2056&height=1334&name=rag-query-drawio%20(1)-png-2.png",alt:null})),(0,n.yg)("p",null,"Image source: ",(0,n.yg)("a",{parentName:"p",href:"https://www.clarifai.com/hs-fs/hubfs/rag-query-drawio%20(1)-png-2.png?width=2056&height=1334&name=rag-query-drawio%20(1)-png-2.png"},"Clarifai portal")),(0,n.yg)("h2",{id:"how-to-create-a-rag-prompter"},"How to Create a RAG Prompter"),(0,n.yg)("p",null,"Let\u2019s demonstrate how you can create a RAG Prompter model on the Clarifai platform. "),(0,n.yg)("admonition",{type:"note"},(0,n.yg)("p",{parentName:"admonition"},"Our intention is to search an app containing textual data for relevant information related to a provided text query. We extract the top k most relevant results from the app, and augment these results into the prompt we provide to the model. By leveraging the additional context, the model should be able to generate a more informative response to the question. ")),(0,n.yg)("h3",{id:"step-1-create-an-application"},"Step 1: Create an Application"),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/clarifai-basics/applications/create-an-application/#create-an-application-on-the-portal"},"Click here")," to learn how to create an application on the Clarifai portal."),(0,n.yg)("admonition",{title:"Base Workflow",type:"caution"},(0,n.yg)("p",{parentName:"admonition"},"When creating the application, select the ",(0,n.yg)("strong",{parentName:"p"},"Text/Document")," option as the primary input type. And in the collapsible ",(0,n.yg)("strong",{parentName:"p"},"Advanced Settings")," field, select an embeddings workflow, such as the ",(0,n.yg)("a",{parentName:"p",href:"https://clarifai.com/clarifai/main/workflows/baai-general-embedding-base-en"},"baai-general-embedding-base-en")," as the ",(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/portal-guide/workflows/base-workflows/"},"base workflow"),". The base workflow will convert the uploaded data into indexed vectors, which makes them searchable \u2013 as explained earlier. ")),(0,n.yg)("h3",{id:"step-2-upload-data"},"Step 2: Upload Data"),(0,n.yg)("p",null,"Next, upload the external data you want to use to optimize the output of a large language model. ",(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/portal-guide/data/#upload-inputs"},"Click here")," to learn how you can upload data to your application. "),(0,n.yg)("admonition",{title:"RAG in four lines of code",type:"warning"},(0,n.yg)("p",{parentName:"admonition"},(0,n.yg)("a",{parentName:"p",href:"https://www.clarifai.com/blog/retrieval-augmented-generation-rag-in-4-lines-of-code"},"Click here")," to learn how to build a RAG system in four lines of code. You\u2019ll also learn how to upload documents seamlessly to your Clarifai application. ")),(0,n.yg)("p",null,"For this example, let's add the following five inputs to our app:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"The audit findings indicate that $460,000 was expended on machinery repairs during the previous twelve months. \n")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"The total expenditure allocated to machinery repairs in the 2022 fiscal year amounted to $500,000. \n")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"The expenses for machinery repairs in the year 2021 totaled $550,000, reflecting increased maintenance requirements.\n")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"The financial records indicate that $480,000 was disbursed for machinery repairs during 2020 calendar year.\n")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"During the 2019 fiscal year, the organization disbursed $475,000 on machinery repairs to ensure operational efficiency. \n")),(0,n.yg)("h3",{id:"step-3-create-a-workflow"},"Step 3: Create a workflow"),(0,n.yg)("p",null,"Go to the ",(0,n.yg)("a",{parentName:"p",href:"https://docs.clarifai.com/portal-guide/workflows/workflow-builder/"},"workflow builder"),". "),(0,n.yg)("p",null,"Then, search for ",(0,n.yg)("strong",{parentName:"p"},"rag-prompter")," in the left-hand sidebar and drag it onto the empty workspace. Use the pop-up that appears on the right-hand sidebar to set up the template text as a single-line statement."),(0,n.yg)("p",null,"For this example, let's use this prompt template text:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"Context information is below: {data.hits} Given the context information and not prior knowledge, answer the query.Query: {data.text.raw} Answer: \n")),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"Your prompt template must include at least one instance of each of these placeholders: ",(0,n.yg)("inlineCode",{parentName:"p"},"{data.text.raw}")," and ",(0,n.yg)("inlineCode",{parentName:"p"},"{data.hits}"),". During inference, all instances of ",(0,n.yg)("inlineCode",{parentName:"p"},"{data.text.raw}")," within the template will be substituted with the user query provided. Similarly, ",(0,n.yg)("inlineCode",{parentName:"p"},"{data.hits}")," will represent a newline-separated list of search results retrieved from your app\u2019s data and ordered by similarity.")),(0,n.yg)("p",null,"To customize your search experience, you can:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Adjust the ",(0,n.yg)("inlineCode",{parentName:"p"},"min_score")," parameter if you desire a minimum threshold for search result scores.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Modify ",(0,n.yg)("inlineCode",{parentName:"p"},"max_results")," to specify the maximum number of relevant search results included in the prompt."))),(0,n.yg)("p",null,"To finalize creating your workflow, connect the ",(0,n.yg)("strong",{parentName:"p"},"rag-prompter")," to a text-to-text node, and choose a text-to-text LLM from the Clarifai Community, such as the ",(0,n.yg)("a",{parentName:"p",href:"https://clarifai.com/mistralai/completion/models/mistral-7B-Instruct"},"Mistral-7B-instruct"),"."),(0,n.yg)("p",null,"Then, save your workflow."),(0,n.yg)("p",null,"Here is an example:"),(0,n.yg)("p",null,(0,n.yg)("img",{src:a(99703).A,width:"1911",height:"831"})),(0,n.yg)("h3",{id:"step-4-use-the-workflow"},"Step 4: Use the workflow"),(0,n.yg)("p",null,"After saving the workflow, you\u2019ll be directed to its individual page, where you can start using it. "),(0,n.yg)("p",null,"Click the ",(0,n.yg)("strong",{parentName:"p"},"+")," button to provide your query text."),(0,n.yg)("p",null,"For example, you could provide the following as your input text:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"How much was spent on machinery repairs in 2020?\n")),(0,n.yg)("p",null,"Click the ",(0,n.yg)("strong",{parentName:"p"},"Submit")," button."),(0,n.yg)("p",null,"Once the workflow has completed processing your input, you'll see the results, starting with the earlier template text, now adapted to your input."),(0,n.yg)("p",null,"As you can see below, the LLM model leveraged the additional context to generate an accurate response to the question. "),(0,n.yg)("p",null,(0,n.yg)("img",{src:a(10972).A,width:"1891",height:"904"})),(0,n.yg)("p",null,"That\u2019s it!"))}u.isMDXComponent=!0},99703:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/rag-prompter-1-bb3f7c6de6f373a65df3135e411bc9f0.png"},10972:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/rag-prompter-2-a4e1807e9818bfb583d00393763755ae.png"}}]);