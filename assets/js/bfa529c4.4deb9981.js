"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[7457],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=u(n),m=o,f=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return n?a.createElement(f,s(s({ref:t},d),{},{components:n})):a.createElement(f,s({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},58215:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:o},t)}},26396:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(87462),o=n(67294),r=n(72389),s=n(79443);var i=function(){var e=(0,o.useContext)(s.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},l=n(53810),u=n(86010),d="tabItem_vU9c";function p(e){var t,n,r,s=e.lazy,p=e.block,c=e.defaultValue,m=e.values,f=e.groupId,h=e.className,_=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=m?m:_.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),b=(0,l.lx)(g,(function(e,t){return e.value===t.value}));if(b.length>0)throw new Error('Docusaurus error: Duplicate values "'+b.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var w=null===c?c:null!=(t=null!=c?c:null==(n=_.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=_[0])?void 0:r.props.value;if(null!==w&&!g.some((function(e){return e.value===w})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+w+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=i(),k=v.tabGroupChoices,y=v.setTabGroupChoices,I=(0,o.useState)(w),T=I[0],N=I[1],C=[],E=(0,l.o5)().blockElementScrollPositionUntilNextRender;if(null!=f){var O=k[f];null!=O&&O!==T&&g.some((function(e){return e.value===O}))&&N(O)}var M=function(e){var t=e.currentTarget,n=C.indexOf(t),a=g[n].value;a!==T&&(E(t),N(a),null!=f&&y(f,a))},S=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=C.indexOf(e.currentTarget)+1;n=C[a]||C[0];break;case"ArrowLeft":var o=C.indexOf(e.currentTarget)-1;n=C[o]||C[C.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":p},h)},g.map((function(e){var t=e.value,n=e.label,r=e.attributes;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:function(e){return C.push(e)},onKeyDown:S,onFocus:M,onClick:M},r,{className:(0,u.Z)("tabs__item",d,null==r?void 0:r.className,{"tabs__item--active":T===t})}),null!=n?n:t)}))),s?(0,o.cloneElement)(_.filter((function(e){return e.props.value===T}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},_.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function c(e){var t=(0,r.Z)();return o.createElement(p,(0,a.Z)({key:String(t)},e))}},36838:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return d},metadata:function(){return p},toc:function(){return c},default:function(){return f}});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),s=n(26396),i=n(58215),l=["components"],u={description:"Train the complete graph for your model.",sidebar_position:6},d="Deep Training",p={unversionedId:"api-guide/model/deep-training",id:"api-guide/model/deep-training",title:"Deep Training",description:"Train the complete graph for your model.",source:"@site/docs/api-guide/model/deep-training.md",sourceDirName:"api-guide/model",slug:"/api-guide/model/deep-training",permalink:"/docs-new/api-guide/model/deep-training",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api-guide/model/deep-training.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{description:"Train the complete graph for your model.",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Create, Get, Update, Delete",permalink:"/docs-new/api-guide/model/create-get-update-and-delete"},next:{title:"Evaluating Models",permalink:"/docs-new/api-guide/evaluate/"}},c=[{value:"Template types",id:"template-types",children:[{value:"Visual Classifier",id:"visual-classifier",children:[],level:4},{value:"Visual Detector",id:"visual-detector",children:[],level:4},{value:"Visual Embedder",id:"visual-embedder",children:[],level:4}],level:2},{value:"Hyperparameters",id:"hyperparameters",children:[],level:2},{value:"Create",id:"create",children:[{value:"Create a Visual Classifier",id:"create-a-visual-classifier",children:[],level:3},{value:"Create a Visual Detector",id:"create-a-visual-detector",children:[],level:3},{value:"Create a Visual Embedder",id:"create-a-visual-embedder",children:[],level:3},{value:"Create a Workflow with a Deep Trained Model",id:"create-a-workflow-with-a-deep-trained-model",children:[],level:3},{value:"Update your Default Workflow with your Deep Trained Model",id:"update-your-default-workflow-with-your-deep-trained-model",children:[],level:3}],level:2}],m={toc:c};function f(e){var t=e.components,n=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deep-training"},"Deep Training"),(0,r.kt)("p",null,'Clarifai offers a variety of prebuilt models that are designed to help you build AI solutions quickly and efficiently. Clarifai Models are the recommended starting point for many users because they offer incredibly fast training times when you customize them using the "Context-Based Classifier" type in Portal\'s Model Mode.'),(0,r.kt)("p",null,'But there are many cases where accuracy and the ability to carefully target solutions takes priority over speed and ease of use. Additionally, you may need a model to learn new features not recognized by existing Clarifai Models. For these cases, it is possible to "deep train" your custom models and integrate them directly within your workflows.'),(0,r.kt)("p",null,"In general, deep trained models need more data than ones trained on top of Clarifai Models. For most applications you\u2019ll need at least 1000 training inputs, but it could be much more than this depending on your specific use case."),(0,r.kt)("p",null,"You might consider deep training if you have:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"A custom tailored dataset")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Accurate labels")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Expertise and time to fine tune models"))),(0,r.kt)("p",null,"Deep training is in early access preview. To request access, ",(0,r.kt)("a",{parentName:"p",href:"https://www.clarifai.com/contact"},"contact us"),"."),(0,r.kt)("h2",{id:"template-types"},"Template types"),(0,r.kt)("p",null,"You can take advantage of a variety of templates when building your deep trained models. Templates give you the control to choose the specific architecture used by your neural network, and also define a set of hyperparameters that you can use to fine-tune the way that your model learns."),(0,r.kt)("h4",{id:"visual-classifier"},"Visual Classifier"),(0,r.kt)("p",null,"Classification templates let you classify what is in your images or videos."),(0,r.kt)("h4",{id:"visual-detector"},"Visual Detector"),(0,r.kt)("p",null,"Detection templates make it easy to build models that can identify objects within a region of your images or videos. Detection models return concepts and bounding boxes."),(0,r.kt)("h4",{id:"visual-embedder"},"Visual Embedder"),(0,r.kt)("p",null,"Embedding models can be useful in their own right ","(","for applications like clustering and visual search",")",', or as an input to a machine learning model for a supervised task. In effect, embedding templates enable you to create your own "base models" that you can then use in your workflows.'),(0,r.kt)("h2",{id:"hyperparameters"},"Hyperparameters"),(0,r.kt)("p",null,"Deep training gives you the power to tune the hyperparameters that affect \u201chow\u201d your model learns. Model Mode dynamically changes the available hyperparameters based on the template selected."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"average","_","horizontal","_","flips")," Provides basic data augmentation for your dataset. If set to true, there is a 0.5 probability that current image and associated ground truth will flip horizontally."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"base","_","gradient","_","multiplier")," This sets the learning rate of the pre-initialized base ","(",'also sometimes called "backbone"',")"," model that generates embeddings. Learning rate controls how the weights of our network are adjusted with respect to the loss gradient. The lower the value, the slower the trip along the downward slope. A low learning rate can help ensure that local minima are not missed, but can take a long time to converge \u2014 especially if the model gets stuck on a plateau region."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"batch","_","size")," The number of images used to make updates to the model. Increased batch size allows for a better approximation of gradient over those samples. Batches allow for stochastic gradient descent, by choosing a random set of X images for each training update. You may want to increase batch size if the model is large and taking a long time to train. You also may want to increase the batch size if your total number of model concepts is larger than the batch size ","(","you may want to increase to around 2x the category count",")","."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"detection","_","score","_","threshold")," Only bounding boxes with a detection score above this threshold will be returned."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"image","_","size")," The size of images used for training. Images are scaled for efficient processing, and a lower number will take up less memory and run faster. A higher number will have more pixel information to train on and will increase accuracy."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"init","_","epochs")," The initial number of epochs before the first step/change in the ",(0,r.kt)("strong",{parentName:"li"},"lrate"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"logreg")," Set to True to use ",(0,r.kt)("strong",{parentName:"li"},"logistic regression"),", set to False to use ",(0,r.kt)("strong",{parentName:"li"},"softmax")," ","(","for binary classification",")","."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lrate")," The learning rate is a tuning parameter in an optimization algorithm that determines the step size at each iteration while moving toward a minimum of a loss function."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"num","_","epochs")," An epoch is defined as one-pass over the entire dataset. If you increase it, it will take longer to train but it could make the model more robust."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"num","_","items","_","per","_","epoch"),' The number of training examples per "epoch". An epoch would be defined as one-pass over this amount of examples.'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"per","_","128","_","lrate")," Total change in ",(0,r.kt)("strong",{parentName:"li"},"lrate")," after 128 images processed. This is calculated as lrate = per","_","128","_","lrate ","*"," ","(","batch","_","size / 128",")","."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"per","_","item","_","lrate")," The rate that model weights are changed per item."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"step","_","epochs")," The number of epochs between applications of the step/change in ",(0,r.kt)("strong",{parentName:"li"},"lrate")," scheduler."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"test","_","freq")," The number of epochs should you run before evaluation of the test set. Increased frequency can allow for more granular testing but will extend processing time."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"use","_","perclass","_","regression")," Enables box coordinate local regression on a per-class basis. When set to True there will be ",(0,r.kt)("inlineCode",{parentName:"li"},"num_classes")," sets of regressors for each anchor location, when set to False, there will be one coordinate regressor for each anchor location.")),(0,r.kt)("h2",{id:"create"},"Create"),(0,r.kt)("h3",{id:"create-a-visual-classifier"},"Create a Visual Classifier"),(0,r.kt)("p",null,"Use a visual classifier model if you would like to classify images and videos frames into set of concepts."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import com.clarifai.grpc.api.*;\nimport com.clarifai.grpc.api.status.*;\n\n// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nStruct.Builder trainInfoParams = Struct.newBuilder()\n    .putFields(\n        "num_epochs", Value.newBuilder().setNumberValue(2).build()\n\n    )\n    .putFields(\n        "template", Value.newBuilder().setStringValue("classification_cifar10_v1").build()\n    );\n\nSingleModelResponse postModelsResponse = stub.postModels(\n    PostModelsRequest.newBuilder()\n        .addModels(\n            Model.newBuilder()\n                .setId("lawrence-1591638385")\n                .setModelTypeId("visual-classifier")\n                .setTrainInfo(TrainInfo.newBuilder().setParams(trainInfoParams))\n                .setOutputInfo(\n                    OutputInfo.newBuilder()\n                        .setData(\n                            Data.newBuilder()\n                                .addConcepts(Concept.newBuilder().setId("ferrari23"))\n                                .addConcepts(Concept.newBuilder().setId("outdoors23"))\n                        )\n                        .setOutputConfig(\n                            OutputConfig.newBuilder()\n                                .setClosedEnvironment(true)\n                        )\n                )\n        )\n        .build()\n);\n\nif (postModelsResponse.getStatus().getCode() != StatusCode.SUCCESS) {\n    throw new RuntimeException("Post models failed, status: " + postModelsResponse.getStatus());\n}\n'))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nstub.PostModels(\n    {\n        models: [\n            {\n                id: "lawrence-1591638385",\n                model_type_id: "visual-classifier",\n                train_info: {\n                    params: {\n                        num_epoch: 2,\n                        template: "classification_cifar10_v1"\n                    }\n                },\n                output_info: {\n                    data: {\n                        concepts: [\n                            {id: "ferrari23"},\n                            {id: "outdoors23"}\n                        ]\n                    },\n                    output_config: {\n                        closed_environment: true\n                    }\n                }\n            }\n        ]\n    },\n    metadata,\n    (err, response) => {\n        if (err) {\n            done(err);\n            return;\n        }\n\n        if (response.status.code !== 10000) {\n            done(new Error("Received status: " + response.status.description + "\\n" + response.status.details));\n        }\n\n        done();\n    }\n);\n'))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from google.protobuf.struct_pb2 import Struct\n\n# Insert here the initialization code as outlined on this page:\n# https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\ntrain_params = Struct()\ntrain_params.update(\n{\n  "template": "classification_cifar10_v1",\n  "num_epochs": 2\n}\n)\n\npost_models_response = stub.PostModels(\nservice_pb2.PostModelsRequest(\n  models=[\n    resources_pb2.Model(\n      id="lawrence-1591638385",\n      model_type_id="visual-classifier",\n      train_info=resources_pb2.TrainInfo(params=train_params),\n      output_info=resources_pb2.OutputInfo(\n        data=resources_pb2.Data(\n          concepts=[\n            resources_pb2.Concept(id="ferrari23"),\n            resources_pb2.Concept(id="outdoors23")\n          ]\n        ),\n        output_config=resources_pb2.OutputConfig(closed_environment=True)\n      )\n    )\n  ]\n),\nmetadata=metadata\n)\n\nif post_models_response.status.code != status_code_pb2.SUCCESS:\n    print("There was an error with your request!")\n    print("\\tCode: {}".format(post_models_response.outputs[0].status.code))\n    print("\\tDescription: {}".format(post_models_response.outputs[0].status.description))\n    print("\\tDetails: {}".format(post_models_response.outputs[0].status.details))\n    raise Exception("Post models failed, status: " + post_models_response.status.description)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"cURL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \'https://api.clarifai.com/v2/models\' \\\n    -H \'Authorization: Key YOUR_API_KEY\' \\\n    -H \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "model": {\n            "id": "lawrence-1591638385",\n            "model_type_id": "visual-classifier",\n            "train_info": {\n                "params": {\n                    "template": "classification_cifar10_v1",\n                    "num_epochs": 2\n                }\n            },\n            "output_info": {\n                "data": {\n                    "concepts": [\n                        {"id":"ferrari23"},\n                        {"id":"outdoors23"}\n                    ]\n                },\n                "output_config": {\n                  "closed_environment" : true\n                }\n            }\n        }\n    }\'\n')))),(0,r.kt)("h3",{id:"create-a-visual-detector"},"Create a Visual Detector"),(0,r.kt)("p",null,"Create a visual detector to detect bounding box regions in images or video frames and then classify the detected images. You can also send the image regions to an image cropper model to create a new cropped image."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import com.clarifai.grpc.api.*;\nimport com.clarifai.grpc.api.status.*;\n\n// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nStruct.Builder trainInfoParams = Struct.newBuilder()\n    .putFields(\n        "num_epochs", Value.newBuilder().setNumberValue(2).build()\n\n    )\n    .putFields(\n        "template", Value.newBuilder().setStringValue("Clarifai-InceptionV2").build()\n    );\n\nSingleModelResponse postModelsResponse = stub.postModels(\n    PostModelsRequest.newBuilder()\n        .addModels(\n            Model.newBuilder()\n                .setId("detection-test-1591638385")\n                .setModelTypeId("visual-detector")\n                .setTrainInfo(TrainInfo.newBuilder().setParams(trainInfoParams))\n                .setOutputInfo(\n                    OutputInfo.newBuilder()\n                        .setData(\n                            Data.newBuilder()\n                                .addConcepts(Concept.newBuilder().setId("ferrari23"))\n                                .addConcepts(Concept.newBuilder().setId("outdoors23"))\n                        )\n                        .setOutputConfig(\n                            OutputConfig.newBuilder()\n                                .setClosedEnvironment(true)\n                        )\n                )\n        )\n        .build()\n);\n\nif (postModelsResponse.getStatus().getCode() != StatusCode.SUCCESS) {\n    throw new RuntimeException("Post models failed, status: " + postModelsResponse.getStatus());\n}\n'))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nstub.PostModels(\n    {\n        models: [\n            {\n                id: "detection-test-1591638385",\n                model_type_id: "visual-detector",\n                train_info: {\n                    params: {\n                        num_epoch: 2,\n                        template: "Clarifai-InceptionV2"\n                    }\n                },\n                output_info: {\n                    data: {\n                        concepts: [\n                            {id: "ferrari23"},\n                            {id: "outdoors23"}\n                        ]\n                    },\n                    output_config: {\n                        closed_environment: true\n                    }\n                }\n            }\n        ]\n    },\n    metadata,\n    (err, response) => {\n        if (err) {\n            throw new Error(err);\n        }\n\n        if (response.status.code !== 10000) {\n            throw new Error("Received status: " + response.status.description + "\\n" + response.status.details);\n        }\n    }\n);\n'))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from google.protobuf.struct_pb2 import Struct\n\n# Insert here the initialization code as outlined on this page:\n# https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\ntrain_params = Struct()\ntrain_params.update(\n    {\n        "template": "Clarifai-InceptionV2",\n        "num_epochs": 2\n    }\n)\n\npost_models_response = stub.PostModels(\n    service_pb2.PostModelsRequest(\n        models=[\n            resources_pb2.Model(\n                id="detection-test-1591638385",\n                model_type_id="visual-detector",\n                train_info=resources_pb2.TrainInfo(params=train_params),\n                output_info=resources_pb2.OutputInfo(\n                    data=resources_pb2.Data(\n                        concepts=[\n                            resources_pb2.Concept(id="ferrari23"),\n                            resources_pb2.Concept(id="outdoors23")\n                        ]\n                    ),\n                    output_config=resources_pb2.OutputConfig(closed_environment=True)\n                )\n            )\n        ]\n    ),\n    metadata=metadata\n)\n\nif post_models_response.status.code != status_code_pb2.SUCCESS:\n    print("There was an error with your request!")\n    print("\\tCode: {}".format(post_models_response.outputs[0].status.code))\n    print("\\tDescription: {}".format(post_models_response.outputs[0].status.description))\n    print("\\tDetails: {}".format(post_models_response.outputs[0].status.details))\n    raise Exception("Post models failed, status: " + post_models_response.status.description)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"cURL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \'https://api.clarifai.com/v2/models\' \\\n    -H \'Authorization: Key YOUR_API_KEY\' \\\n    -H \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "model": {\n            "id": "detection-test-1591638385",\n            "model_type_id": "visual-detector",\n            "train_info": {\n                "params": {\n                    "template": "Clarifai-InceptionV2",\n                    "num_epochs": 2\n                }\n            },\n            "output_info": {\n                "data": {\n                    "concepts": [\n                        {"id":"ferrari23"},\n                        {"id":"outdoors23"}\n                    ]\n                },\n                "output_config": {\n                  "closed_environment" : true\n                }\n            }\n        }\n    }\'\n')))),(0,r.kt)("h3",{id:"create-a-visual-embedder"},"Create a Visual Embedder"),(0,r.kt)("p",null,'Create a visual embedding model to transform images and videos frames into "high level" vector representation understood by our AI models. These embeddings enable visual search and can be used as base models to train other models.'),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import com.clarifai.grpc.api.*;\nimport com.clarifai.grpc.api.status.*;\n\n// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nStruct.Builder trainInfoParams = Struct.newBuilder()\n    .putFields(\n        "num_epochs", Value.newBuilder().setNumberValue(2).build()\n\n    )\n    .putFields(\n        "template", Value.newBuilder().setStringValue("classification_basemodel_v1_embed").build()\n    );\n\nSingleModelResponse postModelsResponse = stub.postModels(\n    PostModelsRequest.newBuilder()\n        .addModels(\n            Model.newBuilder()\n                .setId("embed-test-1591638385")\n                .setModelTypeId("visual-embedder")\n                .setTrainInfo(TrainInfo.newBuilder().setParams(trainInfoParams))\n                .setOutputInfo(\n                    OutputInfo.newBuilder()\n                        .setData(\n                            Data.newBuilder()\n                                .addConcepts(Concept.newBuilder().setId("ferrari23"))\n                                .addConcepts(Concept.newBuilder().setId("outdoors23"))\n                        )\n                        .setOutputConfig(\n                            OutputConfig.newBuilder()\n                                .setClosedEnvironment(true)\n                        )\n                )\n        )\n        .build()\n);\n\nif (postModelsResponse.getStatus().getCode() != StatusCode.SUCCESS) {\n    throw new RuntimeException("Post models failed, status: " + postModelsResponse.getStatus());\n}\n'))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nstub.PostModels(\n    {\n        models: [\n            {\n                id: "embed-test-1591638385",\n                model_type_id: "visual-embedder",\n                train_info: {\n                    params: {\n                        num_epoch: 2,\n                        template: "classification_basemodel_v1_embed"\n                    }\n                },\n                output_info: {\n                    data: {\n                        concepts: [\n                            {id: "ferrari23"},\n                            {id: "outdoors23"}\n                        ]\n                    },\n                    output_config: {\n                        closed_environment: true\n                    }\n                }\n            }\n        ]\n    },\n    metadata,\n    (err, response) => {\n        if (err) {\n            throw new Error(err);\n        }\n\n        if (response.status.code !== 10000) {\n            throw new Error("Received status: " + response.status.description + "\\n" + response.status.details);\n        }\n    }\n);\n'))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Insert here the initialization code as outlined on this page:\n# https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nfrom google.protobuf.struct_pb2 import Struct\n\ntrain_params = Struct()\ntrain_params.update(\n    {\n        "template": "classification_basemodel_v1_embed",\n        "num_epochs": 2\n    }\n)\n\npost_models_response = stub.PostModels(\n    service_pb2.PostModelsRequest(\n        models=[\n            resources_pb2.Model(\n                id="embed-test-1591638385",\n                model_type_id="visual-embedder",\n                train_info=resources_pb2.TrainInfo(params=train_params),\n                output_info=resources_pb2.OutputInfo(\n                    data=resources_pb2.Data(\n                        concepts=[\n                            resources_pb2.Concept(id="ferrari23"),\n                            resources_pb2.Concept(id="outdoors23")\n                        ]\n                    ),\n                    output_config=resources_pb2.OutputConfig(closed_environment=True)\n                )\n            )\n        ]\n      ),\n      metadata=metadata\n)\n\nif post_models_response.status.code != status_code_pb2.SUCCESS:\n    print("There was an error with your request!")\n    print("\\tCode: {}".format(post_models_response.outputs[0].status.code))\n    print("\\tDescription: {}".format(post_models_response.outputs[0].status.description))\n    print("\\tDetails: {}".format(post_models_response.outputs[0].status.details))\n    raise Exception("Post models failed, status: " + post_models_response.status.description)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"cURL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \'https://api.clarifai.com/v2/models\' \\\n    -H \'Authorization: Key YOUR_API_KEY\' \\\n    -H \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "model": {\n            "id": "embed-test-1591638385",\n            "model_type_id": "visual-embedder",\n            "train_info": {\n                "params": {\n                    "template": "classification_basemodel_v1_embed",\n                    "num_epochs": 2\n                }\n            },\n            "output_info": {\n                "data": {\n                    "concepts": [\n                        {"id":"ferrari23"},\n                        {"id":"outdoors23"}\n                    ]\n                },\n                "output_config": {\n                  "closed_environment" : true\n                }\n            }\n        }\n    }\'\n')))),(0,r.kt)("h3",{id:"create-a-workflow-with-a-deep-trained-model"},"Create a Workflow with a Deep Trained Model"),(0,r.kt)("p",null,"Put your new deep-trained model to work by adding it to a workflow."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import com.clarifai.grpc.api.*;\nimport com.clarifai.grpc.api.status.*;\n\n// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nMultiWorkflowResponse postWorkflowsResponse = stub.postWorkflows(\n  PostWorkflowsRequest.newBuilder()\n      .addWorkflows(\n          Workflow.newBuilder()\n              .setId("my-new-workflow-id")\n              .addNodes(\n                  WorkflowNode.newBuilder()\n                      .setId("embed")\n                      .setModel(\n                          Model.newBuilder()\n                              .setId("{YOUR_EMBED_MODEL_ID}")\n                              .setModelVersion(\n                                  ModelVersion.newBuilder()\n                                      .setId("{YOUR_EMBED_MODEL_VERSION_ID}")\n                              )\n                      )\n              )\n              .addNodes(\n                  WorkflowNode.newBuilder()\n                      .setId("my-custom-model")\n                      .setModel(\n                          Model.newBuilder()\n                              .setId("{YOUR_CUSTOM_MODEL_ID}")\n                              .setModelVersion(\n                                  ModelVersion.newBuilder()\n                                      .setId("{YOUR_CUSTOM_MODEL_MODEL_VERSION_ID}")\n                              )\n                      )\n                      .addNodeInputs(NodeInput.newBuilder().setNodeId("embed"))\n              )\n      )\n      .build()\n);\n\nif (postWorkflowsResponse.getStatus().getCode() != StatusCode.SUCCESS) {\n    throw new RuntimeException("Post workflows failed, status: " + postWorkflowsResponse.getStatus());\n}\n'))),(0,r.kt)(i.Z,{value:"grpc_nodejs",label:"gRPC NodeJS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nstub.PostWorkflows(\n    {\n        workflows: [\n            {\n                id: "my-new-workflow-id",\n                nodes: [\n                    {\n                        id: "embed",\n                        model: {\n                            id: "{YOUR_EMBED_MODEL_ID}",\n                            model_version: {\n                                id: "{YOUR_EMBED_MODEL_VERSION_ID}"\n                            }\n                        }\n                    },\n                    {\n                        id: "my-custom-model",\n                        model: {\n                            id: "{YOUR_CUSTOM_MODEL_ID}",\n                            model_version: {\n                                id: "{YOUR_CUSTOM_MODEL_VERSION_ID}"\n                            }\n                        },\n                        node_inputs: [\n                            {node_id: "embed"}\n                        ]\n                    }\n                ]\n            }\n        ]\n    },\n    metadata,\n    (err, response) => {\n        if (err) {\n            throw new Error(err);\n        }\n\n        if (response.status.code !== 10000) {\n            console.log(response.status);\n            throw new Error("Post workflows failed, status: " + response.status.description);\n        }\n    }\n);\n'))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Insert here the initialization code as outlined on this page:\n# https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\npost_workflows_response = stub.PostWorkflows(\n    service_pb2.PostWorkflowsRequest(\n        workflows=[\n            resources_pb2.Workflow(\n                id="my-new-workflow-id",\n                nodes=[\n                    resources_pb2.WorkflowNode(\n                        id="embed",\n                        model=resources_pb2.Model(\n                            id="{YOUR_EMBED_MODEL_ID}",\n                            model_version=resources_pb2.ModelVersion(\n                                id="{YOUR_EMBED_MODEL_VERSION_ID}"\n                            )\n                        )\n                    ),\n                    resources_pb2.WorkflowNode(\n                        id="my-custom-model",\n                        model=resources_pb2.Model(\n                            id="{YOUR_CUSTOM_MODEL_ID}",\n                            model_version=resources_pb2.ModelVersion(\n                                id="{YOUR_CUSTOM_MODEL_VERSION_ID}"\n                            )\n                        ),\n                        node_inputs=[\n                            resources_pb2.NodeInput(node_id="embed")\n                        ]\n                    ),\n                ]\n            )\n        ]\n    ),\n    metadata=metadata\n)\n\nif post_workflows_response.status.code != status_code_pb2.SUCCESS:\n    print("There was an error with your request!")\n    print("\\tCode: {}".format(post_workflows_response.outputs[0].status.code))\n    print("\\tDescription: {}".format(post_workflows_response.outputs[0].status.description))\n    print("\\tDetails: {}".format(post_workflows_response.outputs[0].status.details))\n    raise Exception("Post workflows failed, status: " + post_workflows_response.status.description)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"cURL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \'https://api.clarifai.com/v2/workflows\' \\\n    -H \'Authorization: Key YOUR_API_KEY\' \\\n    -H \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "workflows": [\n            {\n                "id": "my-new-workflow-id",\n                "nodes": [\n                    {\n                        "id": "embed",\n                        "model": {\n                            "id": "{YOUR_EMBED_MODEL_ID}",\n                            "model_version": {\n                                "id": "{YOUR_EMBED_MODEL_VERSION_ID}"\n                            }\n                        }\n                    },\n                    {\n                        "id": "my-custom-model",\n                        "model": {\n                            "id": "{YOUR_CUSTOM_MODEL_ID}",\n                            "model_version": {\n                                "id": "{YOUR_CUSTOM_MODEL_VERSION_ID}"\n                            }\n                        },\n                        "node_inputs": [\n                            {\n                                "node_id": "embed"\n                            }\n                        ]\n                    }\n                ]\n            }\n        ]\n    }\'\n')))),(0,r.kt)("h3",{id:"update-your-default-workflow-with-your-deep-trained-model"},"Update your Default Workflow with your Deep Trained Model"),(0,r.kt)("p",null,"Index your inputs with your deep trained model by updating your default workflow. You can also use your deep trained embeddings as the basis for clustering and search."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import com.clarifai.grpc.api.*;\nimport com.clarifai.grpc.api.status.*;\n\n// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nMultiAppResponse patchAppsResponse = stub.patchApps(\n    PatchAppsRequest.newBuilder()\n        .setAction("overwrite")\n        .addApps(\n            App.newBuilder()\n                .setId("{YOUR_APP_ID}")\n                .setDefaultWorkflowId("auto-annotation-workflow-id")\n        ).build()\n);\n\nif (patchAppsResponse.getStatus().getCode() != StatusCode.SUCCESS) {\n    throw new RuntimeException("Patch apps failed, status: " + patchAppsResponse.getStatus());\n}\n'))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Insert here the initialization code as outlined on this page:\n// https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\nstub.PatchApps(\n    {\n        action: "overwrite",\n        apps: [\n            {\n                id: "{YOUR_APP_ID}",\n                default_workflow_id: "auto-annotation-workflow-id"\n            }\n        ]\n    },\n    metadata,\n    (err, response) => {\n        if (err) {\n            throw new Error(err);\n        }\n\n        if (response.status.code !== 10000) {\n            console.log(response.status);\n            throw new Error("Patch apps failed, status: " + response.status.description);\n        }\n    }\n);\n'))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Insert here the initialization code as outlined on this page:\n# https://docs.clarifai.com/api-guide/api-overview/api-clients#client-installation-instructions\n\npatch_apps_response = stub.PatchApps(\n    service_pb2.PatchAppsRequest(\n        action="overwrite",\n        apps=[\n            resources_pb2.App(\n                id="{YOUR_APP_ID}",\n                default_workflow_id="auto-annotation-workflow-id"\n            )\n        ]\n    ),\n    metadata=metadata\n)\n\nif patch_apps_response.status.code != status_code_pb2.SUCCESS:\n    print("There was an error with your request!")\n    print("\\tCode: {}".format(patch_apps_response.outputs[0].status.code))\n    print("\\tDescription: {}".format(patch_apps_response.outputs[0].status.description))\n    print("\\tDetails: {}".format(patch_apps_response.outputs[0].status.details))\n    raise Exception("Patch apps failed, status: " + patch_apps_response.status.description)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"cURL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X PATCH \'https://api.clarifai.com/v2/users/me/apps\' \\\n    -H \'Authorization: Key {{PAT}}\' \\\n    -H \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "action": "overwrite",\n        "apps": [\n            {\n                "id": "{{app}}",\n                "default_workflow_id": "auto-annotation-workflow-ID"\n            }\n        ]\n    }\'\n')))))}f.isMDXComponent=!0}}]);