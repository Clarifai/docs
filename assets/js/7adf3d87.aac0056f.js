"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[6887],{11470:(e,n,a)=>{a.d(n,{A:()=>v});var t=a(96540),s=a(18215),i=a(23104),o=a(56347),r=a(205),l=a(57485),c=a(31682),d=a(70679);function u(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:a,default:t}})=>({value:e,label:n,attributes:a,default:t}))}(a);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,a])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const a=(0,o.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(s),(0,t.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})},[s,a])]}function f(e){const{defaultValue:n,queryString:a=!1,groupId:s}=e,i=h(e),[o,l]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=n.find(e=>e.default)??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:i})),[c,u]=g({queryString:a,groupId:s}),[f,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,s]=(0,d.Dv)(n);return[a,(0,t.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),b=(()=>{const e=c??f;return p({value:e,tabValues:i})?e:null})();(0,r.A)(()=>{b&&l(b)},[b]);return{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),m(e)},[u,m,i]),tabValues:i}}var m=a(92303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=a(74848);function w({className:e,block:n,selectedValue:a,selectValue:t,tabValues:o}){const r=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const n=e.currentTarget,s=r.indexOf(n),i=o[s].value;i!==a&&(l(n),t(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const a=r.indexOf(e.currentTarget)+1;n=r[a]??r[0];break}case"ArrowLeft":{const a=r.indexOf(e.currentTarget)-1;n=r[a]??r[r.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:o.map(({value:e,label:n,attributes:t})=>(0,x.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{r.push(e)},onKeyDown:d,onClick:c,...t,className:(0,s.A)("tabs__item",b.tabItem,t?.className,{"tabs__item--active":a===e}),children:n??e},e))})}function j({lazy:e,children:n,selectedValue:a}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===a);return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function y(e){const n=f(e);return(0,x.jsxs)("div",{className:(0,s.A)("tabs-container",b.tabList),children:[(0,x.jsx)(w,{...n,...e}),(0,x.jsx)(j,{...n,...e})]})}function v(e){const n=(0,m.A)();return(0,x.jsx)(y,{...e,children:u(e.children)},String(n))}},15252:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/sdh-1-fa43a02b174718e511a7ab4b0be7137b.png"},19365:(e,n,a)=>{a.d(n,{A:()=>o});a(96540);var t=a(18215);const s={tabItem:"tabItem_Ymn6"};var i=a(74848);function o({children:e,hidden:n,className:a}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,a),hidden:n,children:e})}},61863:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>b,contentTitle:()=>m,default:()=>j,frontMatter:()=>f,metadata:()=>t,toc:()=>x});const t=JSON.parse('{"id":"product-updates/upcoming-api-changes/secure-data-hosting","title":"Enabling Secure Data Hosting","description":"Learn about how to use SDH to download inputs securely","source":"@site/docs/product-updates/upcoming-api-changes/secure-data-hosting.md","sourceDirName":"product-updates/upcoming-api-changes","slug":"/product-updates/upcoming-api-changes/secure-data-hosting","permalink":"/product-updates/upcoming-api-changes/secure-data-hosting","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":-7,"frontMatter":{"description":"Learn about how to use SDH to download inputs securely","sidebar_position":-7},"sidebar":"tutorialSidebar","previous":{"title":"Changes to Use of PATs and API Keys","permalink":"/product-updates/upcoming-api-changes/pat-api-keys"},"next":{"title":"Changes to Workflow Builder Model IDs","permalink":"/product-updates/upcoming-api-changes/workflow-builder-ids"}}');var s=a(74848),i=a(28453),o=a(11470),r=a(19365),l=a(73748);const c='curl -X GET "https://api.clarifai.com/v2/users/YOUR_USER_ID_HERE/apps/YOUR_APP_ID_HERE/inputs?page=1&per_page=10" \\\n  -H "Authorization: Key YOUR_PAT_HERE" \n',d='"inputs": [{\n        "id": "pbrn1lcfIn7uWzcw",\n        "data": {\n            "image": {\n                "url": "https://samples.clarifai.com/metro-north.jpg",\n                "hosted": {\n                    "prefix": "https://s3.amazonaws.com/clarifai-api/img3/prod",\n                    "suffix": "c272a8b0ea6c47c7b17430b922597aad/140c856dc82565d2c4d6ea720fceff78",\n                    "sizes": ["orig", "tiny", "small", "large"]\n}]\n',u='"inputs": [{\n  "id": "c7711450a21c4f5d86657ec199d8e52a",\n  "data": {\n      "image": {\n          "url": "https://samples.clarifai.com/metro-north.jpg",\n          "hosted": {\n              "prefix": "https://data.clarifai.com",\n              "suffix": "users/alfrick/apps/deep-learning/inputs/image/140c856dc82565d2c4d6ea720fceff78",\n              "sizes": ["orig", "tiny", "small", "large"]\n}]\n',h='curl -X GET "https://data.clarifai.com/orig/users/YOUR_USER_ID_HERE/apps/YOUR_APP_ID_HERE/inputs/image/140c856dc82565d2c4d6ea720fceff78" \\\n  -H "Authorization: Key YOUR_PAT_HERE"\n',p='curl -X GET "https://s3.amazonaws.com/clarifai-api/img3/prod/orig/c272a8b0ea6c47c7b17430b922597aad/140c856dc82565d2c4d6ea720fceff78" \\\n  -H "Authorization: Key YOUR_PAT_HERE" \n',g='import requests\n\nurl = "https://data.clarifai.com/orig/users/YOUR_USER_ID_HERE/apps/YOUR_APP_ID_HERE/inputs/image/140c856dc82565d2c4d6ea720fceff78"\nauthorization_key = "YOUR_AUTHORIZATION_KEY"\n\nif url.startswith("https://data.clarifai.com"):\n    # Download with authorization header\n    headers = {"Authorization": f"Key {authorization_key}"}\n    response = requests.get(url, headers=headers)\nelse:\n    # Download without authorization header\n    response = requests.get(url)\n\n# Process the response or save the downloaded file\nif response.status_code == 200:\n    # File download successful\n    # Process the response content or save the file\n    with open("downloaded_file.txt", "wb") as file:\n        file.write(response.content)\nelse:\n    # File download failed\n    print("File download failed. Status code:", response.status_code)',f={description:"Learn about how to use SDH to download inputs securely",sidebar_position:-7},m="Enabling Secure Data Hosting",b={},x=[{value:"What is Secure Data Hosting?",id:"what-is-secure-data-hosting",level:2},{value:"Uploading and Downloading Inputs",id:"uploading-and-downloading-inputs",level:2},{value:"Uploading",id:"uploading",level:4},{value:"Retrieving",id:"retrieving",level:4},{value:"How it Works",id:"how-it-works",level:2},{value:"What You Need To Do",id:"what-you-need-to-do",level:2}];function w(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"enabling-secure-data-hosting",children:"Enabling Secure Data Hosting"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Learn about how to use SDH to download inputs securely"})}),"\n",(0,s.jsx)("hr",{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Change"}),": Enabling Secure Data Hosting (SDH) feature for all users"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Date"}),":  August 15, 2023 (we\u2019ll enable it in the 9.7 release)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Who is affected"}),": API users who want to download inputs securely"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type of change"}),": Critical, breaking change"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"What you need to do"}),": ",(0,s.jsx)(n.a,{href:"#what-you-need-to-do",children:"See below"})]}),"\n",(0,s.jsx)(n.h2,{id:"what-is-secure-data-hosting",children:"What is Secure Data Hosting?"}),"\n",(0,s.jsx)(n.p,{children:"At Clarifai, we use the Amazon S3 storage service to host user-provided inputs. Additionally, we\u2019ll be introducing Secure Data Hosting (SDH) as an extra layer of security and access control to the data stored on Amazon S3."}),"\n",(0,s.jsx)(n.p,{children:"Secure Data Hosting simply works as a proxy over the Amazon S3 storage service. It acts as an intermediary or middleman, allowing authorized users to access the content stored on Amazon S3. When a user with the necessary authorization tries to access an SDH URL, it will retrieve the corresponding content from the associated S3 URL, and display it to the user."}),"\n",(0,s.jsx)(n.p,{children:"The SDH service uses a token-based authorization mechanism to grant access. All inputs are fetched from the hosted service only with an authorized token\u2014the tokens are issued after a proper user authentication as part of the Clarifai platform login process."}),"\n",(0,s.jsx)(n.p,{children:"By employing secure data hosting as a proxy over Amazon S3, we enhance the security of users\u2019 data while leveraging the robust storage and infrastructure capabilities provided by Amazon S3. The SDH service helps us to ensure that users\u2019 inputs remain protected and can only be accessed by authorized individuals or systems."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After enabling SDH in the 9.7 release, all inputs will be accessible through SDH URLs. The new inputs will be uploaded to S3 as private files, which can only be accessible via secure SDH URLs. S3 URLs will not be accessible through the API anymore as they will be replaced by SDH URLs \u2014all our endpoints will now return SDH URLs instead of S3 URLs."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Old inputs that were added before the release will keep having public S3 URLs, However, if a non-logged-in user still wants to access an S3 URL that was added before the transition, they will still be able to access that old S3 URL because it remains public.\nSDH URLs will only be accessible to logged-in, authorized users."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If you share an SDH URL with someone, they will not be able to download the shared content unless they have access to it; for example, you can add them as a collaborator to the app, or you can add them to the same team as yourself, the app owner."}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"uploading-and-downloading-inputs",children:"Uploading and Downloading Inputs"}),"\n",(0,s.jsx)(n.p,{children:"Let\u2019s demonstrate how Clarifai implements the Secure Data Hosting feature for uploading and downloading user inputs."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"secure data hosting",src:a(15252).A+"",width:"1240",height:"550"})}),"\n",(0,s.jsx)(n.h4,{id:"uploading",children:"Uploading"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"A user starts by uploading an input, such as a file of an image, to the Clarifai platform."}),"\n",(0,s.jsx)(n.li,{children:"Clarifai hosts the file in a Clarifai Amazon S3 bucket."}),"\n",(0,s.jsx)(n.li,{children:"If SDH is enabled for an account, the input hosted on the S3 storage service will be backed by an SDH service with token-based authorization."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"retrieving",children:"Retrieving"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The SDH service will fetch inputs from the S3 storage service via an S3 API, and not the S3 web URLs. So, without an authorized token, a user cannot fetch inputs from the re-hosted URLs."}),"\n",(0,s.jsx)(n.li,{children:"If a user logs in successfully, they are issued with an authorized token, which they can use to fetch inputs via the SDH service."}),"\n",(0,s.jsx)(n.li,{children:"If a user logs out, and they do not have a proper token, they cannot download the SDH URL of the input\u2014even if they have a valid input URL."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How it Works"}),"\n",(0,s.jsxs)(n.p,{children:["You can start by using the ",(0,s.jsx)(n.a,{href:"https://docs.clarifai.com/api-guide/data/create-get-update-delete#list-all-inputs",children:(0,s.jsx)(n.code,{children:"ListInputs"})})," endpoint to list all the inputs in your app."]}),"\n","\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"curl",label:"cURL",children:(0,s.jsx)(l.A,{className:"language-bash",children:c})})}),"\n",(0,s.jsx)(n.p,{children:"If you run the above command, and SDH has not been enabled on your account, you\u2019ll get a response with the hosted information about each input."}),"\n",(0,s.jsx)(n.p,{children:"Here is an example response (it\u2019s truncated for brevity):"}),"\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"json",label:"JSON",children:(0,s.jsx)(l.A,{className:"language-json",children:d})})}),"\n",(0,s.jsx)(n.p,{children:"And if SDH has been enabled on your account, you\u2019ll get the following response:"}),"\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"json",label:"JSON",children:(0,s.jsx)(l.A,{className:"language-json",children:u})})}),"\n",(0,s.jsxs)(n.p,{children:["Let\u2019s talk about the components of the ",(0,s.jsx)(n.code,{children:"image"})," object in the response:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"url"}),"\u2014the original URL that was used to upload the image to the Clarifai platform."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"hosted"}),"\u2014an object nested within the ",(0,s.jsx)(n.code,{children:"image"})," object that contains the details for downloading the image."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"prefix"}),"\u2014the initial part of the URL for downloading the image. If SDH has been enabled on your account, it will be ",(0,s.jsx)(n.code,{children:"https://data.clarifai.com"})," Otherwise, it will be an S3 URL such as ",(0,s.jsx)(n.a,{href:"https://s3.amazonaws.com/clarifai-api/img3/prod",children:"https://s3.amazonaws.com/clarifai-api/img3/prod"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"suffix"}),"\u2014the last part of the URL for downloading the image."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"sizes"}),"\u2014the different sizes you can specify for downloading the image."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To get a downloadable URL for the image, you\u2019ll combine the following:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"prefix + sizes (specify any size) + suffix"})}),"\n",(0,s.jsx)(n.p,{children:"For example, if SDH is enabled, an image\u2019s download URL could look like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"https://data.clarifai.com/orig/users/alfrick/apps/deep-learning/inputs/image/140c856dc82565d2c4d6ea720fceff78\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you click the above URL to access the image, you\u2019ll get an error message. So, without providing the necessary authorization, you cannot access an SDH URL."}),"\n",(0,s.jsx)(n.p,{children:"However, if you provide the authorization, like in the example below, the request will be successful:"}),"\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"curl",label:"cURL",children:(0,s.jsx)(l.A,{className:"language-bash",children:h})})}),"\n",(0,s.jsx)(n.p,{children:"On the other hand, if SDH is disabled, you can also get the download URL by combining the three components."}),"\n",(0,s.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"https://s3.amazonaws.com/clarifai-api/img3/prod/orig/c272a8b0ea6c47c7b17430b922597aad/140c856dc82565d2c4d6ea720fceff78\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you click the above S3 URL, you\u2019ll notice that you can access the image even without providing the necessary authorization."}),"\n",(0,s.jsx)(n.p,{children:"However, if you provide the authorization, like in the example below, the request will fail:"}),"\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"curl",label:"cURL",children:(0,s.jsx)(l.A,{className:"language-bash",children:p})})}),"\n",(0,s.jsx)(n.p,{children:"So, while you require authorization to access an SDH URL, the authorization does not work when accessing an S3 URL."}),"\n",(0,s.jsx)(n.h2,{id:"what-you-need-to-do",children:"What You Need To Do"}),"\n",(0,s.jsx)(n.p,{children:"If you are an API user downloading inputs programmatically, you must change your code to transition from S3 input URLs to SDH input URLs."}),"\n",(0,s.jsx)(n.p,{children:"In order to download the input URL, you need to first check if the URL is an SDH URL or an S3 URL."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If the input URL is an SDH URL, then provide the authorization token to download the URL;"}),"\n",(0,s.jsx)(n.li,{children:"Otherwise, do not provide the authorization token to download the URL."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here is an example in Python:"}),"\n",(0,s.jsx)(o.A,{groupId:"code",children:(0,s.jsx)(r.A,{value:"python",label:"Python",children:(0,s.jsx)(l.A,{className:"language-bash",children:g})})})]})}function j(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(w,{...e})}):w(e)}}}]);